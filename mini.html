<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>gmex ‚Äî –û–±–º–µ–Ω USDT</title>
<style>
  /* --- –î–ò–ó–ê–ô–ù –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï --- */
  :root {
    /* LIGHT MODE (Fallback) */
    --bg: #f5f5f5;
    --card: #ffffff;
    --text: #111111;
    --secondary-text: #6b6b6b;
    --accent: #007AFF; 
    --green-buy: #008000;
    --red-sell: #e53935;
    --border: rgba(0,0,0,0.08);
  }

  @media (prefers-color-scheme: dark) {
    :root {
      /* DARK MODE */
      --bg: #111111;
      --card: #1c1c1c;
      --text: #ffffff;
      --secondary-text: #9a9a9a;
      --accent: #0084ff; 
      --green-buy: #4caf50;
      --red-sell: #ff453a;
      --border: rgba(255,255,255,0.1);
    }
  }

  /* Telegram WebApp Theme Overrides */
  body.twa-dark {
    --bg: var(--tg-theme-bg-color, #111111);
    --card: var(--tg-theme-secondary-bg-color, #1c1c1c);
    --text: var(--tg-theme-text-color, #ffffff);
    --secondary-text: var(--tg-theme-hint-color, #9a9a9a);
    --accent: var(--tg-theme-link-color, #0084ff);
    --border: rgba(255,255,255,0.1);
  }

  html,body{
    height:100%;
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size:15px;
  }
  
  #app{
    max-width:520px;
    margin:0 auto;
    padding:18px 18px 80px 18px; 
    min-height: calc(100vh - 80px);
  }
  
  h2{font-weight:600;margin:0 0 16px 0;font-size:22px}
  h3{font-weight:600;margin:10px 0}
  
  /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
  .card{
    background:var(--card);
    border-radius:14px;
    padding:16px;
    margin:14px 0;
  }
  
  /* –ö–Ω–æ–ø–∫–∏ –ö—É–ø–∏—Ç—å/–ü—Ä–æ–¥–∞—Ç—å */
  .exchange-buttons{display:flex;gap:10px;margin:16px 0 24px 0}
  .exchange-btn{
    flex:1;
    padding:16px; 
    border-radius:14px;
    border:1px solid var(--border);
    background:var(--card); 
    font-weight:600;
    cursor:pointer;
    transition: background 0.1s;
    color: var(--text);
    text-align: center;
  }
  .exchange-btn:active{opacity:0.8;}
  .btn-text {
    font-size: 16px;
    margin-top: 4px;
    font-weight: 500;
  }
  .icon-arrow-up { color:var(--green-buy); font-size: 24px; }
  .icon-arrow-down { color:var(--red-sell); font-size: 24px; }

  /* –°–µ—Ç–∫–∞ –∫—É—Ä—Å–æ–≤ */
  .rate-grid-container {
    display: flex;
    gap: 12px;
    margin-top: 12px;
  }
  .rate-group {
    flex: 1;
    background: var(--card);
    padding: 12px;
    border-radius: 12px;
  }
  .rate-line {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin: 4px 0;
  }
  .rate-label {
    font-size: 13px;
    color: var(--secondary-text);
  }
  .rate-value {
    font-size: 16px;
    font-weight: 600;
  }
  .buy-rate-text { color: var(--green-buy); }
  .sell-rate-text { color: var(--red-sell); }
  
  /* –û–±—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
  .input-separator{border:none;border-top:1px solid var(--border);margin:10px 0}
  .muted{color:var(--secondary-text);font-size:13px}
  a{color:var(--accent);text-decoration:none}
  .footer{font-size:12px;color:var(--secondary-text);text-align:center;margin-top:24px}
  
  /* --- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è --- */
  .nav-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 70px; 
    max-width: 520px;
    margin: 0 auto;
    background: var(--card); 
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding-bottom: env(safe-area-inset-bottom, 8px);
    z-index: 1000;
    box-sizing: content-box;
  }
  .nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    font-size: 11px;
    font-weight: 500;
    color: var(--secondary-text);
    transition: color 0.2s;
  }
  .nav-item.active {color: var(--accent);}
  .nav-item i {
    font-size: 22px;
    margin-bottom: 2px;
    line-height: 1; 
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º—ã */
  input[type="text"], input[type="number"]{
    padding:12px;
    border-radius:10px;
    border:1px solid var(--border);
    outline:none;
    font-size:16px;
    background:var(--bg); 
    color:var(--text);
    width: 100%;
    box-sizing: border-box;
  }
  .input-group label{font-size:13px;color:var(--secondary-text);margin-bottom:6px;display:block;}
  .input-group {margin-bottom: 12px;}

</style>
</head>
<body>
  <div id="app" role="application" aria-label="gmex exchange"></div>
  
  <div class="nav-footer">
    <div class="nav-item active" data-page="home" onclick="showPage('home')">
      <i>üè†</i> –ì–ª–∞–≤–Ω–∞—è
    </div>
    <div class="nav-item" data-page="history" onclick="showPage('history')">
      <i>üìú</i> –ò—Å—Ç–æ—Ä–∏—è
    </div>
    <div class="nav-item" data-page="profile" onclick="showPage('profile')">
      <i>üë§</i> –ü—Ä–æ—Ñ–∏–ª—å
    </div>
  </div>

<script>
  const WebApp = window.Telegram?.WebApp;
  const app = document.getElementById('app');
  // –ü—Ä–∏–º–µ—Ä –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å–∞
  let rates = { 
    usdt_buy: '81.25', 
    usdt_sell: '79.10',
    btc_buy: '2,500,000',
    btc_sell: '2,400,000'
  };

  if (!WebApp) {
    app.innerHTML = '<div class="container"><h2>–û—à–∏–±–∫–∞</h2><p class="muted">–ó–∞–ø—É—Å–∫ MiniApp –≤–Ω–µ Telegram –∏–ª–∏ –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.</p></div>';
    console.error('Telegram WebApp API not found or failed to initialize.');
    document.addEventListener('DOMContentLoaded', () => {
        document.body.style.backgroundColor = '#000000';
    });
    throw new Error('Telegram WebApp API not found');
  }
  
  WebApp.ready();
  
  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–º—ã
  if (WebApp.colorScheme === 'dark') {
    document.body.classList.add('twa-dark');
  } else {
    document.body.classList.remove('twa-dark');
  }
  
  try { WebApp.expand(); } catch(e){ /* ignore */ }

  function updateFooterNav(activePage) {
      document.querySelector('.nav-footer').style.display = 'flex';
      document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.remove('active');
          if (item.getAttribute('data-page') === activePage) {
              item.classList.add('active');
          }
      });
  }

  function sendApplication(type, amount, wallet, fio) {
    const payload = {
      type: type === 'buy' ? '–ü–æ–∫—É–ø–∫–∞ USDT' : '–ü—Ä–æ–¥–∞–∂–∞ USDT',
      amount: String(amount),
      wallet: wallet,
      fio: fio,
      user_tg_id: WebApp.initDataUnsafe?.user?.id || null,
      timestamp: new Date().toISOString()
    };
    WebApp.sendData(JSON.stringify(payload));
    WebApp.showAlert('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ ‚Äî –æ–∂–∏–¥–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.');
    showPage('home');
  }

  function showPage(pageId) {
    // –°–±—Ä–æ—Å –∫–Ω–æ–ø–æ–∫ Telegram
    try {
      WebApp.MainButton.hide();
      WebApp.MainButton.onClick(() => {});
      WebApp.BackButton.hide();
      WebApp.BackButton.onClick(() => {});
    } catch(e){}

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–æ–º
    if (pageId !== 'buy' && pageId !== 'sell') {
        document.querySelector('.nav-footer').style.display = 'flex';
    } else {
        document.querySelector('.nav-footer').style.display = 'none';
    }
    
    updateFooterNav(pageId);

    switch (pageId) {
      case 'home': renderHomePage(); break;
      case 'buy': renderFormPage('buy'); break;
      case 'sell': renderFormPage('sell'); break;
      case 'history': renderHistoryPage(); break;
      case 'profile': renderProfilePage(); break;
      default: renderHomePage(); break;
    }
  }

  function renderHomePage() {
    app.innerHTML = `
      <div class="container">
        <div style="text-align:center;margin-bottom:20px;">
            <div style="font-size:30px;font-weight:900;letter-spacing:2px;color:var(--text);margin-top:10px;">gmex</div>
        </div>

        <h2>–ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –æ–±–º–µ–Ω USDT</h2>

        <div class="exchange-buttons">
          <button class="exchange-btn" onclick="showPage('buy')">
            <div class="icon-arrow-up">‚ñ≤</div>
            <div class="btn-text">–ö—É–ø–∏—Ç—å USDT</div>
          </button>
          <button class="exchange-btn" onclick="showPage('sell')">
            <div class="icon-arrow-down">‚ñº</div>
            <div class="btn-text">–ü—Ä–æ–¥–∞—Ç—å USDT</div>
          </button>
        </div>

        <h3 class="muted" style="margin-bottom:8px;">–ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –Ω–∞ ${new Date().toLocaleTimeString('ru-RU', {hour:'2-digit',minute:'2-digit'})}</h3>
        
        <div class="rate-grid-container">
            <div class="rate-group">
                <div class="rate-line">
                    <span class="rate-label">Tether USDT (RUB)</span>
                    <span class="rate-value">USDT</span>
                </div>
                <hr class="input-separator">
                <div class="rate-line">
                    <span class="rate-label">–ü–æ–∫—É–ø–∫–∞ (‚ÇΩ)</span>
                    <span class="rate-value buy-rate-text">${rates.usdt_buy}</span>
                </div>
                <div class="rate-line">
                    <span class="rate-label">–ü—Ä–æ–¥–∞–∂–∞ (‚ÇΩ)</span>
                    <span class="rate-value sell-rate-text">${rates.usdt_sell}</span>
                </div>
            </div>
            
            <div class="rate-group">
                <div class="rate-line">
                    <span class="rate-label">Bitcoin (RUB)</span>
                    <span class="rate-value">BTC</span>
                </div>
                <hr class="input-separator">
                <div class="rate-line">
                    <span class="rate-label">–ü–æ–∫—É–ø–∫–∞ (‚ÇΩ)</span>
                    <span class="rate-value buy-rate-text">${rates.btc_buy}</span>
                </div>
                <div class="rate-line">
                    <span class="rate-label">–ü—Ä–æ–¥–∞–∂–∞ (‚ÇΩ)</span>
                    <span class="rate-value sell-rate-text">${rates.btc_sell}</span>
                </div>
            </div>
        </div>

        <div class="card">
          <h3 style="margin-top:0;">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –ü—Ä–∞–≤–∏–ª–∞</h3>
          
          <div style="margin-bottom: 12px;">
              <p class="muted" style="margin:0;font-weight:500;">–ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞</p>
              <p style="margin:4px 0 0 0;font-size:14px;">–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –¥–æ—Å—Ç—É–ø–Ω–∞ 24/7 (Support)</p>
          </div>
          
          <hr class="input-separator">
          
          <div style="margin-bottom: 12px;">
              <p class="muted" style="margin:0;font-weight:500;">–ü—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–∏—Å–∞</p>
              <p style="margin:4px 0 0 0;font-size:14px;">AML / KYC / KYT –ø–æ–ª–∏—Ç–∏–∫–∏</p>
          </div>
        </div>

        <div class="footer">¬© gmex | <a href="#" onclick="WebApp.openTelegramLink('https://t.me/gadzhigg'); return false;">–°—É–ø–ø–æ—Ä—Ç</a></div>
      </div>
    `;
  }

  function renderFormPage(type) {
    const isBuy = type === 'buy';
    const title = isBuy ? '–ö—É–ø–∏—Ç—å USDT (TRC-20)' : '–ü—Ä–æ–¥–∞—Ç—å USDT (–í–∞—à–∞ —Å–µ—Ç—å)';
    const minAmount = isBuy ? 100000 : 10000;
    const walletPlaceholder = isBuy ? '–ê–¥—Ä–µ—Å TRC-20' : '–ê–¥—Ä–µ—Å/–°–µ—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è';
    const currentRate = isBuy ? rates.usdt_buy : rates.usdt_sell;

    app.innerHTML = `
      <div class="container">
        <h2>${title}</h2>
        <p class="muted">–ö—É—Ä—Å: ${currentRate} ‚ÇΩ | –ú–∏–Ω. —Å—É–º–º–∞: ${minAmount.toLocaleString('ru-RU')} ‚ÇΩ</p>

        <div class="card">
          <div class="input-group">
            <label for="amount">–°—É–º–º–∞ (‚ÇΩ)*</label>
            <input id="amount" type="number" min="0" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –≤ —Ä—É–±–ª—è—Ö">
          </div>
          <hr class="input-separator">
          <div class="input-group">
            <label for="wallet">–ö–æ—à–µ–ª–µ–∫ / –°–µ—Ç—å*</label>
            <input id="wallet" type="text" placeholder="${walletPlaceholder}">
          </div>
        </div>

        <div class="card">
          <h3 style="margin-top:0;">–î–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ (–¥–ª—è KYC)</h3>
          <div class="input-group">
            <label for="fio-last">–§–∞–º–∏–ª–∏—è*</label>
            <input id="fio-last" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é">
          </div>
          <hr class="input-separator">
          <div class="input-group">
            <label for="fio-first">–ò–º—è*</label>
            <input id="fio-first" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
          </div>
          <hr class="input-separator">
          <div class="input-group">
            <label for="fio-patronymic">–û—Ç—á–µ—Å—Ç–≤–æ</label>
            <input id="fio-patronymic" type="text" placeholder="–û—Ç—á–µ—Å—Ç–≤–æ (–µ—Å–ª–∏ –µ—Å—Ç—å)">
          </div>
        </div>

        <div style="display:flex;align-items:center;margin:12px 0;">
          <input id="terms" type="checkbox" style="accent-color:var(--accent);margin-right:10px;">
          <label for="terms" class="muted">–Ø –ø—Ä–∏–Ω–∏–º–∞—é <a href="#" onclick="WebApp.showPopup && WebApp.showPopup({title:'–ü—Ä–∞–≤–∏–ª–∞', message:'–ó–¥–µ—Å—å –ø—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–∏—Å–∞.'}); return false;">–ø—Ä–∞–≤–∏–ª–∞ –∏ —É—Å–ª–æ–≤–∏—è</a></label>
        </div>

        <div class="muted" style="font-size:12px">–ù–∞–∂–∏–º–∞—è "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö.</div>
        
        <div style="height: 60px;"></div>
      </div>
    `;

    WebApp.BackButton.onClick(() => {showPage('home');});
    try { WebApp.BackButton.show(); } catch(e){}

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MainButton
    try {
      WebApp.MainButton.setText(isBuy ? '–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–∫—É–ø–∫—É' : '–û—Ñ–æ—Ä–º–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É');
      WebApp.MainButton.show();
      WebApp.MainButton.setColor(WebApp.themeParams.link_color || '#007AFF');
    } catch(e){}

    const handler = () => {
      const amount = Number(document.getElementById('amount').value || 0);
      const wallet = (document.getElementById('wallet').value || '').trim();
      const lastName = (document.getElementById('fio-last').value || '').trim();
      const firstName = (document.getElementById('fio-first').value || '').trim();
      const patronymic = (document.getElementById('fio-patronymic').value || '').trim();
      const terms = document.getElementById('terms').checked;

      if (!terms) { WebApp.showAlert('–ü—Ä–∏–º–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–∏—Å–∞.'); return; }
      if (!amount || amount < minAmount) { WebApp.showAlert(`–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ ${minAmount.toLocaleString('ru-RU')} ‚ÇΩ`); return; }
      if (!wallet || !lastName || !firstName) { WebApp.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è.'); return; }

      const fio = `${lastName} ${firstName}` + (patronymic ? ` ${patronymic}` : '');
      sendApplication(type, amount, wallet, fio);
    };

    try { WebApp.MainButton.onClick(handler); } catch(e){ /* ignore */ }
  }

  function renderHistoryPage() {
    app.innerHTML = `
      <div class="container card" style="text-align:center;padding-top:40px;">
        <p style="font-size:48px;margin:0 0 8px 0">üìú</p>
        <h2 style="margin:8px 0 0 0">–ú–æ–∏ –∑–∞—è–≤–∫–∏</h2>
        <p class="muted">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –∑–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–∞. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞—è–≤–∫—É!</p>
      </div>
    `;
  }

  function renderProfilePage() {
    const user = WebApp.initDataUnsafe?.user || {};
    const nick = user.username ? '@' + user.username : '–ù–µ—Ç –Ω–∏–∫–Ω–µ–π–º–∞';
    const full = (user.first_name || '') + (user.last_name ? ' ' + user.last_name : '');
    const language = user.language_code || 'N/A';

    app.innerHTML = `
      <div class="container">
        <h2>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
        <div class="card">
          <h3 style="margin-top:0;">–î–∞–Ω–Ω—ã–µ Telegram</h3>
          <p class="muted" style="margin:0">–ò–º—è –≤ TG: <span style="color:var(--text);">${full || 'N/A'}</span></p>
          <hr class="input-separator">
          <p class="muted" style="margin:0">–ù–∏–∫ –≤ TG: <span style="color:var(--text);">${nick}</span></p>
          <hr class="input-separator">
          <p class="muted" style="margin:0">ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: <span style="color:var(--text);">${user.id || 'N/A'}</span></p>
        </div>
        
        <div class="card">
            <h3 style="margin-top:0;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            <p class="muted" style="margin:0">–Ø–∑—ã–∫: <span style="color:var(--text);">${language}</span></p>
            <hr class="input-separator">
            <p class="muted" style="margin:0">–¢–µ–º–∞: <span style="color:var(--text);">${WebApp.colorScheme === 'dark' ? '–¢–µ–º–Ω–∞—è' : '–°–≤–µ—Ç–ª–∞—è'}</span></p>
        </div>

      </div>
    `;
  }

  window.showPage = showPage;
  document.addEventListener('DOMContentLoaded', () => showPage('home'));
</script>
</body>
</html>


