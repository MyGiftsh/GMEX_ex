<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>gmex ‚Äî –û–±–º–µ–Ω USDT</title>
<style>
  /* --- –î–ò–ó–ê–ô–ù DARK MODE --- */
  :root {
    /* LIGHT MODE (Fallback) */
    --bg: #ffffff;
    --card: #f7f7f7;
    --text: #111111;
    --secondary-text: #6b6b6b;
    --accent: #007AFF; 
    --green-buy: #0bb36b;
    --red-sell: #ff3b30;
    --border: rgba(0,0,0,0.08);
  }

  @media (prefers-color-scheme: dark) {
    :root {
      /* DARK MODE */
      --bg: #111111;
      --card: #1c1c1c;
      --text: #ffffff;
      --secondary-text: #9a9a9a;
      --accent: #0084ff; 
      --green-buy: #00e073;
      --red-sell: #ff453a;
      --border: rgba(255,255,255,0.1);
    }
  }

  /* Telegram WebApp Theme Overrides */
  body.twa-dark {
    --bg: var(--tg-theme-bg-color, #111111);
    --card: var(--tg-theme-secondary-bg-color, #1c1c1c);
    --text: var(--tg-theme-text-color, #ffffff);
    --secondary-text: var(--tg-theme-hint-color, #9a9a9a);
    --accent: var(--tg-theme-link-color, #0084ff);
    --border: rgba(255,255,255,0.1);
  }

  html,body{
    height:100%;
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size:15px;
  }
  
  #app{
    max-width:520px;
    margin:0 auto;
    padding:18px 18px 80px 18px; 
    min-height: calc(100vh - 80px);
  }
  
  h2{font-weight:600;margin:0 0 16px 0;font-size:22px}
  h3{font-weight:600;margin:10px 0}
  .container{display:block}
  
  .card{
    background:var(--card);
    border-radius:14px;
    padding:16px;
    margin:14px 0;
    box-shadow:0 2px 5px rgba(0,0,0,0.1); 
  }
  .exchange-buttons{display:flex;gap:10px;margin:16px 0}
  .exchange-btn{
    flex:1;
    padding:16px; 
    border-radius:14px;
    border:none; 
    background:var(--card); 
    font-weight:600;
    cursor:pointer;
    box-shadow:0 1px 3px rgba(0,0,0,0.08); 
    transition: background 0.1s;
    color: var(--text); 
  }
  .exchange-btn:active{opacity:0.8;}
  .buy-btn span{color:var(--green-buy)}
  .sell-btn span{color:var(--red-sell)}

  .rate-grid{display:flex;gap:12px;margin-top:12px}
  .rate-card{
    flex:1;
    background:var(--card);
    padding:10px;
    border-radius:10px;
    text-align:center
  }

  .input-group{display:flex;flex-direction:column;margin-bottom:12px}
  label{font-size:13px;color:var(--secondary-text);margin-bottom:6px}
  input[type="text"], input[type="number"]{
    padding:12px;
    border-radius:10px;
    border:1px solid var(--border);
    outline:none;
    font-size:16px;
    background:var(--bg); 
    color:var(--text);
  }
  .input-separator{border:none;border-top:1px solid var(--border);margin:10px 0}
  .muted{color:var(--secondary-text);font-size:13px}
  a{color:var(--accent);text-decoration:none}
  .footer{font-size:12px;color:var(--secondary-text);text-align:center;margin-top:24px}
  
  /* --- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è --- */
  .nav-footer {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 70px; 
    max-width: 520px;
    margin: 0 auto;
    background: var(--card); 
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding-bottom: env(safe-area-inset-bottom, 8px);
    z-index: 1000;
    box-sizing: content-box;
  }
  .nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    font-size: 11px;
    font-weight: 500;
    color: var(--secondary-text);
    transition: color 0.2s;
  }
  .nav-item.active {color: var(--accent);}
  .nav-item i {
    font-size: 22px;
    margin-bottom: 2px;
    line-height: 1; 
  }
</style>
</head>
<body>
  <div id="app" role="application" aria-label="gmex exchange"></div>
  
  <div class="nav-footer">
    <div class="nav-item active" data-page="home" onclick="showPage('home')">
      <i>üè†</i> –ì–ª–∞–≤–Ω–∞—è
    </div>
    <div class="nav-item" data-page="history" onclick="showPage('history')">
      <i>üìú</i> –ò—Å—Ç–æ—Ä–∏—è
      </div>
    <div class="nav-item" data-page="profile" onclick="showPage('profile')">
      <i>üë§</i> –ü—Ä–æ—Ñ–∏–ª—å
    </div>
  </div>

<script>
  const WebApp = window.Telegram?.WebApp;
  const app = document.getElementById('app');
  let rates = { buy: '80.50', sell: '79.00' };

  if (!WebApp) {
    app.innerHTML = '<div class="container"><h2>–û—à–∏–±–∫–∞</h2><p class="muted">–ó–∞–ø—É—Å–∫ MiniApp –≤–Ω–µ Telegram –∏–ª–∏ –æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.</p></div>';
    console.error('Telegram WebApp API not found or failed to initialize.');
    document.addEventListener('DOMContentLoaded', () => {
        document.body.style.backgroundColor = '#000000';
    });
    throw new Error('Telegram WebApp API not found');
  }
  
  WebApp.ready();
  
  if (WebApp.colorScheme === 'dark') {
    document.body.classList.add('twa-dark');
  } else {
    document.body.classList.remove('twa-dark');
  }
  
  try { WebApp.expand(); } catch(e){ /* ignore */ }

  function updateFooterNav(activePage) {
      document.querySelector('.nav-footer').style.display = 'flex';
      document.querySelectorAll('.nav-item').forEach(item => {
          item.classList.remove('active');
          if (item.getAttribute('data-page') === activePage) {
              item.classList.add('active');
          }
      });
  }

  function sendApplication(type, amount, wallet, fio) {
    const payload = {
      type: type === 'buy' ? '–ü–æ–∫—É–ø–∫–∞ USDT' : '–ü—Ä–æ–¥–∞–∂–∞ USDT',
      amount: String(amount),
      wallet: wallet,
      fio: fio,
      user_tg_id: WebApp.initDataUnsafe?.user?.id || null,
      timestamp: new Date().toISOString()
    };
    WebApp.sendData(JSON.stringify(payload));
    WebApp.showAlert('–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ ‚Äî –æ–∂–∏–¥–∞–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.');
    showPage('home');
  }

  function showPage(pageId) {
    try {
      WebApp.MainButton.hide();
      WebApp.MainButton.onClick(() => {});
      WebApp.BackButton.hide();
      WebApp.BackButton.onClick(() => {});
    } catch(e){}

    if (pageId !== 'buy' && pageId !== 'sell') {
        document.querySelector('.nav-footer').style.display = 'flex';
    }
    
    updateFooterNav(pageId);

    switch (pageId) {
      case 'home': renderHomePage(); break;
      case 'buy': renderFormPage('buy'); break;
      case 'sell': renderFormPage('sell'); break;
      case 'history': renderHistoryPage(); break;
      case 'profile': renderProfilePage(); break;
      default: renderHomePage(); break;
    }
  }

  function renderHomePage() {
    app.innerHTML = `
      <div class="container">
        <h2>–ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –æ–±–º–µ–Ω USDT</h2>
        <div class="exchange-buttons">
          <button class="exchange-btn" onclick="showPage('buy')">
            <span class="buy-btn"><div style="font-size:20px;margin-bottom:4px;">‚Üë</div> –ö—É–ø–∏—Ç—å USDT</span>
          </button>
          <button class="exchange-btn" onclick="showPage('sell')">
            <span class="sell-btn"><div style="font-size:20px;margin-bottom:4px;">‚Üì</div> –ü—Ä–æ–¥–∞—Ç—å USDT</span>
          </button>
        </div>

        <h3 class="muted">–ê–∫—Ç—É–∞–ª—å–Ω—ã–π –∫—É—Ä—Å –Ω–∞ ${new Date().
            toLocaleTimeString('ru-RU', {hour:'2-digit',minute:'2-digit'})}</h3>
        <div class="rate-grid">
          <div class="rate-card">
            <span class="muted">–ü–æ–∫—É–ø–∫–∞</span>
            <h3 style="margin:6px 0;color:var(--green-buy)">${rates.buy} ‚ÇΩ</h3>
          </div>
          <div class="rate-card">
            <span class="muted">–ü—Ä–æ–¥–∞–∂–∞</span>
            <h3 style="margin:6px 0;color:var(--red-sell)">${rates.sell} ‚ÇΩ</h3>
          </div>
        </div>

        <div class="card">
          <h3 style="margin-top:0;">–û –Ω–∞—Å</h3>
          <p class="muted">–ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ‚Äî –¥–æ—Å—Ç—É–ø–Ω–æ 24/7</p>
          <hr class="input-separator">
          <p class="muted">–ü—Ä–∞–≤–∏–ª–∞ AML / KYC / KYT</p>
        </div>

        <div class="footer">¬© gmex</div>
      </div>
    `;
  }

  function renderFormPage(type) {
    const isBuy = type === 'buy';
    const title = isBuy ? '–ö—É–ø–∏—Ç—å USDT' : '–ü—Ä–æ–¥–∞—Ç—å USDT';
    const minAmount = isBuy ? 100000 : 10000;
    const walletPlaceholder = isBuy ? '–ö–æ—à–µ–ª–µ–∫ (TRC-20 / TRC20)' : '–°–µ—Ç—å –∏–ª–∏ –∫–æ—à–µ–ª–µ–∫';
    
    document.querySelector('.nav-footer').style.display = 'none';

    app.innerHTML = `
      <div class="container">
        <h2>${title}</h2>
        <p class="muted">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –æ–±–º–µ–Ω–∞: ${minAmount.toLocaleString('ru-RU')} ‚ÇΩ</p>

        <div class="card">
          <div class="input-group">
            <label for="amount">–°—É–º–º–∞ (‚ÇΩ)*</label>
            <input id="amount" type="number" min="0" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É">
          </div>
          <hr class="input-separator">
          <div class="input-group">
            <label for="wallet">–ö–æ—à–µ–ª–µ–∫ / –°–µ—Ç—å*</label>
            <input id="wallet" type="text" placeholder="${walletPlaceholder}">
          </div>
        </div>

        <div class="card">
          <div class="input-group">
            <label for="fio-last">–§–∞–º–∏–ª–∏—è*</label>
            <input id="fio-last" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é">
          </div>
          <hr class="input-separator">
          <div class="input-group">
            <label for="fio-first">–ò–º—è*</label>
            <input id="fio-first" type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
          </div>
          <hr class="input-separator">
          <div class="input-group">
            <label for="fio-patronymic">–û—Ç—á–µ—Å—Ç–≤–æ</label>
            <input id="fio-patronymic" type="text" placeholder="–û—Ç—á–µ—Å—Ç–≤–æ (–µ—Å–ª–∏ –µ—Å—Ç—å)">
          </div>
        </div>

        <div style="display:flex;align-items:center;margin:12px 0;">
          <input id="terms" type="checkbox" style="accent-color:var(--accent);margin-right:10px;">
          <label for="terms" class="muted">–Ø –ø—Ä–∏–Ω–∏–º–∞—é <a href="#" onclick="WebApp.showPopup && WebApp.showPopup({title:'–ü—Ä–∞–≤–∏–ª–∞', message:'–ó–¥–µ—Å—å –ø—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–∏—Å–∞.'}); return false;">–ø—Ä–∞–≤–∏–ª–∞ –∏ —É—Å–ª–æ–≤–∏—è</a></label>
        </div>

        <div class="muted" style="font-size:12px">–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä—É –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.</div>
        
        <div style="height: 60px;"></div>
      </div>
    `;

    WebApp.BackButton.onClick(() => {showPage('home');});

    try {
      WebApp.MainButton.setText('–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å');
      WebApp.MainButton.show();
      try {
        WebApp.MainButton.setColor(WebApp.themeParams.link_color || '#007AFF');
      } catch(e){}
    } catch(e){}

    const handler = () => {
      const amount = Number(document.getElementById('amount').value || 0);
      const wallet = (document.getElementById('wallet').value || '').trim();
      const lastName = (document.getElementById('fio-last').value || '').trim();
      const firstName = (document.getElementById('fio-first').value || '').trim();
      const patronymic = (document.getElementById('fio-patronymic').value || '').trim();
      const terms = document.getElementById('terms').checked;

      if (!terms) { WebApp.showAlert('–ü—Ä–∏–º–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ —Å–µ—Ä–≤–∏—Å–∞.'); return; }
      if (!amount || amount < minAmount) { WebApp.showAlert(`–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ ${minAmount.toLocaleString('ru-RU')} ‚ÇΩ`); return; }
      if (!wallet  !lastName  !firstName) { WebApp.showAlert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è.'); return; }

      const fio = ${lastName} ${firstName} + (patronymic ?  ${patronymic} : '');
      sendApplication(type, amount, wallet, fio);
    };

    try {
      WebApp.MainButton.onClick(handler);
    } catch(e){ /* ignore */ }

    try {
      WebApp.BackButton.show();
    } catch(e){}
  }

  function renderHistoryPage() {
    app.innerHTML = `
      <div class="container" style="text-align:center;padding-top:40px;">
        <p style="font-size:48px;margin:0 0 8px 0">üëÄ</p>
        <h2 style="margin:8px 0 0 0">–ó–¥–µ—Å—å –ø—É—Å—Ç–æ</h2>
        <p class="muted">–°–æ–∑–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É –∏ –º—ã –æ—Ç–æ–±—Ä–∞–∑–∏–º –µ—ë –∑–¥–µ—Å—å.</p>
      </div>
    `;
  }

  function renderProfilePage() {
    const user = WebApp.initDataUnsafe?.user || {};
    const nick = user.username ? '@' + user.username : '–ù–µ—Ç –Ω–∏–∫–Ω–µ–π–º–∞';
    const full = (user.first_name || '') + (user.last_name ? ' ' + user.last_name : '');

    app.innerHTML = `
      <div class="container">
        <h2>–ü—Ä–æ—Ñ–∏–ª—å gmex</h2>
        <div class="card">
          <p class="muted" style="margin:0">–ò–º—è –≤ TG: ${full || 'N/A'}</p>
          <hr class="input-separator">
          <p class="muted" style="margin:0">–ù–∏–∫ –≤ TG: ${nick}</p>
          <hr class="input-separator">
          <p class="muted" style="margin:0">ID: ${user.id || 'N/A'}</p>
        </div>
      </div>
    `;
  }

  window.showPage = showPage;
  document.addEventListener('DOMContentLoaded', () => showPage('home'));
</script>
</body>
</html>
